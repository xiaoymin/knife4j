---
id: customer-add-api
title: è‡ªå®šä¹‰APIæ¥å£åœ¨Knife4jçš„Uiç•Œé¢ä¸­æ˜¾ç¤º
description: è‡ªå®šä¹‰APIæ¥å£åœ¨Knife4jçš„Uiç•Œé¢ä¸­æ˜¾ç¤º
keywords:
- springfoxè‡ªå®šä¹‰æ¥å£
- springdocè‡ªå®šä¹‰æ¥å£
- knife4jè‡ªå®šä¹‰æ¥å£
sidebar_position: 4
author: å…«ä¸€èœåˆ€
data: 2023å¹´7æœˆ13æ—¥
---


æœ¬æ–‡ä¸»è¦ä»‹ç»åœ¨ Spring Boot åº”ç”¨ä¸­,å¦‚ä½•ä½¿ç”¨ springfox å’Œ springdoc æ¡†æ¶è‡ªå®šä¹‰æ·»åŠ å¤–éƒ¨ API æ¥å£,å¹¶åœ¨ Knife4j çš„ UI ç•Œé¢ä¸­å±•ç¤ºã€‚

å…³è”Issuesï¼š

- âœ… [æ·»åŠ SpringSecurityç™»å½•æ¥å£åˆ°knife4jä¸­](https://gitee.com/xiaoym/knife4j/issues/I640E8)
- 

ğŸ–ï¸ æœ¬æ–‡ä»“åº“ï¼š[knife4j-customer-api](https://github.com/xiaoymin/knife4j-demo/tree/master/knife4j-customer-api)

ğŸ“¹ è§†é¢‘åœ°å€ï¼š[https://www.bilibili.com/video/BV19h4y1j7y9/?vd_source=ef34098d916a578698508a43063099ac](https://www.bilibili.com/video/BV19h4y1j7y9/?vd_source=ef34098d916a578698508a43063099ac)
<iframe src="//player.bilibili.com/player.html?aid=615960537&bvid=BV19h4y1j7y9&cid=1196531434&page=1&high_quality=1&danmaku=0" allowfullscreen="allowfullscreen" width="100%" height="500" scrolling="no" frameborder="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"></iframe>


## ğŸŒ± æœ¬è´¨

æˆ‘ä»¬è¦å®ç°å°†è‡ªå®šä¹‰çš„APIæ¥å£æ·»åŠ åˆ°Uiç•Œé¢ä¸­æ˜¾ç¤ºï¼Œå…¶å®æœ€ç®€å•çš„å°±æ˜¯åœ¨æˆ‘ä»¬æ¥å£æ¸²æŸ“çš„Swaggeræˆ–è€…OpenAPIå¯¹è±¡ä¸­ï¼Œæ·»åŠ ç›¸åº”çš„æ–°å¯¹è±¡(PS:ç”¨äºåœ¨OpenAPIè§„èŒƒä¸­æè¿°æ¥å£å®šä¹‰çš„`Operation`å¯¹è±¡)å±æ€§å°±å¥½äº†

è¿™éœ€è¦å€ŸåŠ©äºåº•å±‚è§£ææ¡†æ¶å¯¹å¤–æ˜¯å¦æä¾›äº†å¼€æ”¾æ¥å£ï¼Œå…è®¸æˆ‘ä»¬è¿™ä¹ˆåšï¼Œè¿˜å¥½ç›®å‰ä¸ç®¡æ˜¯springfoxæˆ–è€…springdocï¼Œå…¶å®éƒ½æ”¯æŒå¼€å‘è€…è‡ªå®šä¹‰ã€‚

ä¸»è¦çš„åŒºåˆ«æ˜¯ï¼š

- âœ… **springfox**æä¾›çš„æ˜¯[spring-plugin](/docs/action/springfox/springfox3)ä½“ç³»ï¼Œåœ¨è§£ææ—¶æ·»åŠ `Operation`å¯¹è±¡ï¼Œè¿™æ˜¯è¿›è¡Œä¸­çš„å¤„ç†è¡Œä¸º
- âœ… **springdoc**æä¾›çš„å…¨å±€Customeræ¥å£ï¼Œspringdocå·²ç»å®Œæˆäº†æ‰€æœ‰æ¥å£çš„å¯¹è±¡è§£æï¼Œä½†å¼€å‘è€…å®ç°Customeræ¥å£å¯ä»¥è‡ªå®šä¹‰æ›´æ”¹ï¼Œè¿™æ˜¯åç½®è¡Œä¸º


## ğŸ“œ springfox

åœ¨springfoxçš„æ¡†æ¶ä¸­ï¼Œæä¾›äº†åŸºäºspring-pluginä½“ç³»çš„è§£ææ¥å£ï¼Œå¼€å‘è€…å¦‚æœé˜…è¯»è¿‡springfoxçš„æºç åï¼Œåº”è¯¥å¾ˆè½»æ¾å°±èƒ½å®ç°

ä¸»è¦çš„åŠ¨ä½œåŒ…æ‹¬ï¼š

- ğŸ  è‡ªå®šä¹‰pluginæ¥å£ï¼Œå®ç°`ApiListingScannerPlugin.java`ç±»ï¼Œå¹¶ä¸”é€šè¿‡`@Component`æˆ–è€…Java Configå¾—`@Bean`æ³¨è§£æ³¨å…¥åˆ°Springçš„å®¹å™¨ä¸­
- ğŸ¢ åˆ›å»º`Operation`å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ˜¯ä¸€ä¸ªæ¥å£çš„æè¿°ï¼ŒåŒ…æ‹¬ï¼šè¯´æ˜ã€å‚æ•°ã€å“åº”ã€è¯·æ±‚ç±»å‹ç­‰ç­‰ï¼Œå¹¶ä¸”è¿”å›`ApiListingScannerPlugin.java`æ¥å£çº¦æŸçš„æ–¹æ³•ç±»å‹
- ğŸï¸ springfoxè¿™ç§æ–¹å¼åªèƒ½æä¾›ç®€å•çš„formè¡¨å•ç±»å‹çš„æ¥å£ï¼Œå¦‚æœæ˜¯ç±»ä¼¼`@RequestBody`ç±»å‹çš„JSONã€XMLè¯·æ±‚ï¼Œé‚£ä¹ˆ**å»ºè®®æ”¾å¼ƒ~**


ç¤ºä¾‹:æ·»åŠ ä¸€ä¸ªç®€å•çš„loginç™»å½•æ¥å£ï¼Œä»£ç å¦‚ä¸‹ï¼š

```javascript title="com.xiaominfo.springfox.customer.CustomerApiPlugin.java"
@Slf4j
@Component
public class CustomerApiPlugin implements ApiListingScannerPlugin {
    
    @Override
    public List<ApiDescription> apply(DocumentationContext context) {
        // consumersã€produces
        Set<String> mediaSet = new HashSet<>();
        mediaSet.add(MediaType.APPLICATION_JSON_VALUE);
        // è®¾å®šå‚æ•°
        List<Parameter> parameters = new ArrayList<>();
        parameters.add(new ParameterBuilder().name("username").required(true).modelRef(new ModelRef("String")).defaultValue("test").description("ç”¨æˆ·å").build());
        parameters.add(new ParameterBuilder().name("password").required(true).modelRef(new ModelRef("String")).defaultValue("123").description("å¯†ç ").build());
        // æ¥å£çš„Tag
        Set<String> tags = new HashSet<>();
        tags.add("é¦–é¡µ");
        // æ„å»ºOperationå¯¹è±¡
        Operation usernamePasswordOperation = new OperationBuilder(new CachingOperationNameGenerator())
                .method(HttpMethod.POST)
                .tags(tags)
                .summary("ç”¨æˆ·åå¯†ç ç™»å½•")
                .notes("ç”¨æˆ·ç™»é™†è·å–token")
                .parameters(parameters)
                .consumes(mediaSet)
                .produces(mediaSet)
                .build();
        
        // éœ€è¦æ³¨æ„çš„æ˜¯groupNameéœ€è¦å’Œå¼€å‘è€…åˆ›å»ºçš„Docketå¯¹è±¡èµ‹å€¼çš„groupNameä¿æŒä¸€è‡´
        ApiDescription loginApiDescription = new ApiDescription("hello", "/login", "ç™»å½•æ¥å£æè¿°", Collections.singletonList(usernamePasswordOperation), false);
        return Collections.singletonList(loginApiDescription);
    }
    
    @Override
    public boolean supports(DocumentationType documentationType) {
        return documentationType == DocumentationType.SWAGGER_2;
    }
}
```


## ğŸ“š springdoc

åœ¨springdocä¸­ï¼Œå…¶å®å’Œspringdocçš„æ€æƒ³æ˜¯å®Œå…¨ä¸€è‡´çš„,springdocä¹Ÿå¼€æ”¾äº†ä¸¤ç§çº§åˆ«çš„customizeræ¥å£ï¼š

- ğŸœï¸ `GlobalOperationCustomizer`ï¼šé’ˆå¯¹Operationçº§åˆ«çš„å…¨å±€è‡ªå®šä¹‰æ‰©å±•é’©å­å‡½æ•°ï¼Œå¼€å‘è€…å¯ä»¥å¯¹æ¥å£ä¸­æ¯ä¸€ä¸ªOperationè¿›è¡Œæ‰©å±•è‡ªå®šä¹‰å®ç°ï¼Œæˆ–è°ƒæ•´ï¼Œæˆ–ä¿®æ”¹ï¼Œæˆ–å¢åŠ æ‰©å±•éƒ½è¡Œï¼ŒKnife4jçš„éƒ¨åˆ†å¢å¼ºç‰¹æ€§å°±æ˜¯åŸºäºæ­¤å‡½æ•°å®ç°ï¼Œå¯ä»¥å‚è€ƒä»£ç [Knife4jJakartaOperationCustomizer.java](https://gitee.com/xiaoym/knife4j/blob/dev/knife4j/knife4j-openapi3-jakarta-spring-boot-starter/src/main/java/com/github/xiaoymin/knife4j/spring/extension/Knife4jJakartaOperationCustomizer.java)
- ğŸï¸ `GlobalOpenApiCustomizer`ï¼šæ˜¯é’ˆå¯¹æ•´ä¸ªOpenAPIçº§åˆ«çš„,å¼€å‘è€…åœ¨åˆ†ç»„æˆ–è€…åˆ†åŒ…åï¼Œå¾—åˆ°çš„å•ä¸ªOpenAPIå®ä¾‹ï¼Œå¼€å‘è€…å¯ä»¥æ“çºµå…¨å±€çš„OpenAPIå®ä¾‹ï¼Œè¯¥OpenAPIå¯¹è±¡å·²ç»æ˜¯springdocè§£æè¿‡çš„å®ä¾‹å¯¹è±¡ï¼Œä¾‹å¦‚è¯¥issuesä¸­çš„éœ€æ±‚ï¼Œå¼€å‘è€…åªéœ€è¦è‡ªå®šä¹‰åˆ›å»ºæ–°Operationå¯¹è±¡ï¼Œç„¶åé€šè¿‡OpenAPIå®ä¾‹å¯¹è±¡è¿›è¡Œaddæ·»åŠ å³å¯å®Œæˆæ­¤éœ€æ±‚ï¼Œéƒ¨åˆ†æ‰©å±•å¯ä»¥å‚è€ƒä»£ç ï¼š[Knife4jOpenApiCustomizer.java](https://gitee.com/xiaoym/knife4j/blob/dev/knife4j/knife4j-openapi3-jakarta-spring-boot-starter/src/main/java/com/github/xiaoymin/knife4j/spring/extension/Knife4jOpenApiCustomizer.java)
- ğŸ  æ‰©å±•å®ç°ç±»æ¥å£åï¼Œæ³¨å…¥Springçš„å®¹å™¨ä¸­å³å¯

è€ƒè™‘åˆ°æˆ‘ä»¬æ˜¯æ–°å¢è‡ªå®šä¹‰çš„APIæ¥å£ï¼Œå› æ­¤ï¼Œå¯ä»¥å®ç°`GlobalOpenApiCustomizer`ç±»è¿›è¡Œæ‰©å±•

ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š
```javascript title="com.xiaominfo.springdoc.customer.CustomerOperation.java"
@Slf4j
@Component
public class CustomerOperation implements GlobalOpenApiCustomizer {
    
    @Override
    public void customise(OpenAPI openApi) {
        log.info("customer.");
        // å› ä¸ºè¦æ–°å¢è‡ªå®šä¹‰çš„æ¥å£ï¼Œç›´æ¥è¿™é‡Œadd
        PathItem pathItem = new PathItem();
        // åŸºç¡€ä¿¡æ¯ æ„å»ºOperation
        Operation operation = new Operation();
        operation.operationId("login");
        operation.summary("ç™»å½•æ¥å£");
        operation.description("æ ¹æ®ç”¨æˆ·åå’Œå¯†ç ç™»å½•è·å–token");
        operation.tags(Collections.singletonList("ç™»å½•"));
        // æ„å»ºå‚æ•°
        List<Parameter> parameters = new ArrayList<>();
        parameters.add(new Parameter().name("name").example("zhangFei").description("ç”¨æˆ·å").required(true).schema(new StringSchema()).in("query"));
        parameters.add(new Parameter().name("password").example("123456").description("å¯†ç ").required(true).schema(new StringSchema()).in("query"));
        operation.parameters(parameters);
        // æ„å»ºå“åº”body
        ApiResponses apiResponses = new ApiResponses();
        ApiResponse apiResponse = new ApiResponse();
        apiResponse.description("ok").content(new Content().addMediaType("*/*", new MediaType().schema(new StringSchema())));
        apiResponses.addApiResponse("200",apiResponse);
        operation.responses(apiResponses);
        // è¯¥è‡ªå®šä¹‰æ¥å£ä¸ºpost
        pathItem.post(operation);
        openApi.path("/login", pathItem);
    }
}
```

æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç•Œé¢ä¸­æŸ¥çœ‹ï¼Œå·²ç»å­˜åœ¨äº†æˆ‘ä»¬è‡ªå®šä¹‰æ–°å¢çš„æ¥å£ï¼Œå¦‚ä¸‹å›¾ï¼š

![å›¾1.è‡ªå®šä¹‰APIæ¥å£åœ¨Knife4jçš„Uiç•Œé¢ä¸­æ˜¾ç¤º](/images/blog/customer-api/customer-api-preview.jpg)


## ğŸ“– æ€»ç»“

æœ¬æ–‡ä¸»è¦ä»‹ç»äº†åŸºäºspringfoxæˆ–è€…springdocæ¡†æ¶ï¼Œæ·»åŠ è‡ªå®šä¹‰APIæ¥å£çš„ç¤ºä¾‹ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®å…¶ä¸­çš„æ€æƒ³è‡ªè¡Œæ‰©å±•ï¼Œè¾¾åˆ°è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚ã€‚