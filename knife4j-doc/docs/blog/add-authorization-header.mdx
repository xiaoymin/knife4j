---
id: add-authorization-header
title: OpenAPI3è§„èŒƒä¸­æ·»åŠ Authorizationé‰´æƒè¯·æ±‚Headerä¸ç”Ÿæ•ˆï¼Ÿ
description: OpenAPI3è§„èŒƒä¸­æ·»åŠ Authorizationé‰´æƒè¯·æ±‚Headerä¸ç”Ÿæ•ˆ
keywords:
- knife4j-openapi3 å®‰å…¨è®¤è¯ä¸ç”Ÿæ•ˆ
- Authorizationé‰´æƒä¸ç”Ÿæ•ˆ
- knife4jä¸­Authorizationä¸ç”Ÿæ•ˆ
sidebar_position: 4
author: å…«ä¸€èœåˆ€
data: 2023å¹´12æœˆ09æ—¥
---

æœ¬æ–‡ä¸»è¦åˆ†äº«å¾ˆå¤šå¼€å‘è€…åœ¨Knife4jçš„issueä¸­åé¦ˆé’ˆå¯¹é‰´æƒAuthorizationä¸ç”Ÿæ•ˆé—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬å°†é’ˆå¯¹è¿™ä¸ªé—®é¢˜è¿›è¡Œè¯¦ç»†çš„è¯´æ˜ã€‚

å…³è”Issuesï¼š

- âœ… [knife4j-openapi3 å®‰å…¨è®¤è¯ä¸ç”Ÿæ•ˆ](https://github.com/xiaoymin/knife4j/issues/653)
- âœ… [å…¨å±€è¯·æ±‚å¤´Authorizationæ— æ•ˆçš„é—®é¢˜](https://github.com/xiaoymin/knife4j/issues/545)
- âœ… [4.0 openapi3 æ¨¡å— æ— æ³•å…¨å±€æºå¸¦é‰´æƒå¤´é—®é¢˜](https://github.com/xiaoymin/knife4j/issues/524)
- âœ… [è®¾ç½®äº†å…¨å±€å®‰å…¨éªŒè¯ï¼Œä½†æ˜¯è°ƒè¯•è¯·æ±‚æ—¶ä¸ç”Ÿæ•ˆï¼ˆv4.0.0ï¼‰](https://github.com/xiaoymin/knife4j/issues/523)
- âœ… [Authorize ä¸ç”Ÿæ•ˆ](https://github.com/xiaoymin/knife4j/issues/630)
- âœ… [Authorize æœªç”Ÿæ•ˆï¼Œè¯·æ±‚æ¥å£æ—¶Headeré‡ŒæœªåŒ…å«tokenå‚æ•°ï¼Œswagger-uiä¸­èƒ½æ­£å¸¸æºå¸¦è¯¥Headerå‚æ•°](https://gitee.com/xiaoym/knife4j/issues/I7WDK9)
- âœ… [[Bug] Authorizeé¡µé¢è®¾ç½®å¥½è¯·æ±‚å¤´ä¹‹åå¹¶æœªåœ¨æ¥å£ä¸­å¯ç”¨](https://gitee.com/xiaoym/knife4j/issues/I7B10Z)
- ......


## Securityåœ¨è§„èŒƒä¸­çš„å®šä¹‰

å…ˆæ¥çœ‹OpenAPI3è§„èŒƒå¯¹äºSecurityçš„å®šä¹‰è¯´æ˜ï¼Œä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š

- åœ¨compoentsç»„ä»¶ä¸‹å®šä¹‰Securityçš„é‰´æƒæ–¹æ¡ˆç±»å‹
- åœ¨æ¥å£çº§åˆ«çš„Operationå¯¹è±¡çº§åˆ«ä¸‹çš„securityå±æ€§ä¸­å¼•ç”¨compoentsç»„ä»¶ä¸­å®šä¹‰çš„Securityçš„é‰´æƒæ–¹æ¡ˆç±»å‹

ä¸€ä¸ªæ¥å£å®ä¾‹çš„Opertationå¯¹è±¡å®šä¹‰ç¤ºä¾‹å¦‚ä¸‹ï¼š

```yaml
tags:
- pet
summary: Updates a pet in the store with form data
operationId: updatePetWithForm
parameters:
- name: petId
  in: path
  description: ID of pet that needs to be updated
  required: true
  schema:
    type: string
requestBody:
  content:
    'application/x-www-form-urlencoded':
      schema:
       type: object
       properties:
          name: 
            description: Updated name of the pet
            type: string
          status:
            description: Updated status of the pet
            type: string
       required:
         - status
responses:
  '200':
    description: Pet updated.
    content: 
      'application/json': {}
      'application/xml': {}
  '405':
    description: Method Not Allowed
    content: 
      'application/json': {}
      'application/xml': {}
# æ¥å£çº§åˆ«ï¼Œè¿™é‡Œå¼•ç”¨é‰´æƒæ–¹æ¡ˆ
security:
- petstore_auth:
  - write:pets
  - read:pets

```

è¿™é‡Œåœ¨Operationæ¥å£çº§åˆ«ä¸‹ï¼Œä½¿ç”¨äº†securityå±æ€§ï¼Œè¡¨ç¤ºè¯¥æ¥å£éœ€è¦é‰´æƒï¼Œä½†æ˜¯æ­¤å¤„æˆ‘ä»¬å¹¶ä¸çŸ¥é“é‰´æƒçš„æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ

OpenAPI3è§„èŒƒå¯¹è¯¥å±æ€§çš„å®šä¹‰å¦‚ä¸‹ï¼š

![å›¾1.OpenAPI3è§„èŒƒå¯¹æ¥å£ä¸‹çš„securityå®šä¹‰](/images/blog/add-authorization-header/operation-security.png)

ç¿»è¯‘è¿‡æ¥çš„æ„æ€å°±æ˜¯å£°æ˜å“ªäº›å®‰å…¨æ–¹æ¡ˆï¼ˆSecurity Schemeï¼‰è¢«åº”ç”¨äºè¯¥æ¥å£æ“ä½œä½¿ç”¨

è¿™é‡Œå°±ä¼šå’ŒKnife4jç›®å‰çš„è§£æè§„åˆ™ç»™å¼€å‘è€…ä¼šé€ æˆå›°æ‰°ï¼Œå› ä¸ºKnife4jç›®å‰çš„è§£æè§„åˆ™æ˜¯ï¼š

- å¦‚æœå½“å‰OpenAPI3è§„èŒƒä¸­çš„æ¥å£å®šä¹‰å¹¶æ²¡æœ‰`security`å±æ€§å¯¹è±¡ï¼Œé‚£ä¹ˆKnife4jä¼šè®¤ä¸ºè¯¥æ¥å£ä¸éœ€è¦é‰´æƒ

è€Œsecurityçš„é‰´æƒç±»å‹å®šä¹‰ï¼Œåˆ™æ˜¯åœ¨OpenAPI3è§„èŒƒçš„`compoents`èŠ‚ç‚¹ä¸‹å®šä¹‰çš„ï¼Œè§„èŒƒè¯´æ˜å¦‚ä¸‹å›¾

![å›¾2.OpenAPI3è§„èŒƒå¯¹é‰´æƒæ–¹æ¡ˆçš„securityå®šä¹‰](/images/blog/add-authorization-header/compoents-security.png)

è§„èŒƒå‚è€ƒåœ°å€ï¼š[https://spec.openapis.org/oas/latest.html#securitySchemeObject](https://spec.openapis.org/oas/latest.html#securitySchemeObject)

åœ¨`compoents`èŠ‚ç‚¹ä¸‹çš„Securityå¯¹è±¡æ˜ç¡®å®šä¹‰äº†æ¥å£çš„é‰´æƒç±»å‹ï¼Œä¸»æµçš„åŒ…æ‹¬ï¼šapiKeyã€httpã€oauth2ã€openIdConnect

å¼€å‘è€…ä¸€èˆ¬ä½¿ç”¨æœ€å¤šçš„`Authorization`æœ€ç»ˆåœ¨OpenAPI3è§„èŒƒä¸‹çš„å®šä¹‰å¦‚ä¸‹ï¼š

```json
"components": {
    "securitySchemes": {
        "Authorization": {
            "type": "http",
            "scheme": "bearer"
        }
    }
}

```

## Knife4jç•Œé¢è°ƒè¯•ç•Œé¢ä¸æ˜¾ç¤º

å¯¹äºä¸Šé¢OpenAPI3çš„è§„èŒƒæœ‰äº†åˆæ­¥äº†è§£åï¼Œå†æ¥çœ‹åœ¨Knife4jä¸­ä¸ºä»€ä¹ˆä¸æ˜¾ç¤ºçš„é—®é¢˜ï¼Œå¾ˆå¤šå¼€å‘è€…åˆ›å»ºäº†OpenAPIçš„`@Bean`é…ç½®ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
@Bean
public OpenAPI customOpenAPI() {
    return new OpenAPI()
            .info(new Info()
                    .title("XXXç”¨æˆ·ç³»ç»ŸAPI")
                    .version("1.0")

                    .description( "Knife4jé›†æˆspringdoc-openapiç¤ºä¾‹")
                    .termsOfService("http://doc.xiaominfo.com")
                    .license(new License().name("Apache 2.0")
                            .url("http://doc.xiaominfo.com"))
                    ).addSecurityItem(new SecurityRequirement().addList(HttpHeaders.AUTHORIZATION))
            .components(new Components().addSecuritySchemes(HttpHeaders.AUTHORIZATION,new SecurityScheme()
                    .name(HttpHeaders.AUTHORIZATION).type(SecurityScheme.Type.HTTP).scheme("bearer")));
}
```

è¿™æ ·çš„å®šä¹‰æ–¹å¼ï¼Œä¼šåœ¨Knife4jçš„ç•Œé¢å°†OpenAPI3è§„èŒƒä¸­å®šä¹‰çš„é‰´æƒæ–¹æ¡ˆæ˜¾ç¤ºå‡ºæ¥ï¼Œä½†æ˜¯åœ¨è°ƒè¯•ç•Œé¢ä¸­å¹¶ä¸ä¼šæ˜¾ç¤ºï¼Œä¸ºä»€ä¹ˆï¼Ÿ


å‚è€ƒ[springdoc-openapiçš„æ–‡æ¡£](https://springdoc.org/#how-do-i-add-authorization-header-in-requests)ï¼Œä½ è¿˜éœ€è¦åœ¨æ¥å£å±‚é¢å®šä¹‰ä½¿ç”¨ï¼Œå¦‚ä¸‹ï¼š

```java
@Operation(security = { @SecurityRequirement(name = HttpHeaders.AUTHORIZATION) })
```
æˆ–è€…
```java
@SecurityRequirement(name = HttpHeaders.AUTHORIZATION)
@Operation(summary = "æè¿°1")
@PostMapping("/description")
public ResponseEntity<ConfigPageParam> description(@ParameterObject ConfigPageParam configPageParam){
    return ResponseEntity.ok(configPageParam);
}
```

åªæœ‰å®šä¹‰äº†äº†å…¨å±€çš„æ¥å£é‰´æƒæ–¹æ¡ˆï¼Œå¹¶ä¸”åœ¨æ¥å£å±‚é¢ä½¿ç”¨äº†`@Operation`æ³¨è§£ï¼Œç¡®è®¤æ¥å£ä½¿ç”¨é‚£ç§é‰´æƒæ–¹æ¡ˆï¼Œè¿™æ ·Knife4jæ‰ä¼šåœ¨è°ƒè¯•ç•Œé¢ä¸­æ˜¾ç¤ºå‡ºæ¥

å¯¹äºè¿™æ ·çš„ç­–ç•¥ï¼Œæˆ‘è®¤ä¸ºç›®å‰Knife4jçš„Uiç‰ˆæœ¬å¤„ç†æ–¹å¼å¹¶æ²¡æœ‰è¯´æ˜é—®é¢˜ã€‚

**å¦‚æœå½“å‰OpenAPI3è§„èŒƒä¸­çš„æ¥å£å®šä¹‰å¹¶æ²¡æœ‰`security`å±æ€§å¯¹è±¡ï¼Œé‚£ä¹ˆKnife4jä¼šè®¤ä¸ºè¯¥æ¥å£ä¸éœ€è¦é‰´æƒ**


## è§£å†³æ–¹æ¡ˆ

ä»ä¸Šé¢çš„è§„èŒƒå®šä¹‰ï¼Œä»¥åŠäº†è§£äº†ä½¿ç”¨æ–¹æ³•åï¼Œå¼€å‘è€…åˆä¼šæå‡ºç–‘é—®ï¼Ÿ

æ¥å£ä¼—å¤šï¼Œæ¯ä¸ªæ¥å£éƒ½æ·»åŠ `@SecurityRequirement`æ³¨è§£é‚£ä¸æ˜¯è¦ç–¯æ‰äº†ä¹ˆï¼Ÿ

å¥½åœ¨springdoc-openapiæä¾›çš„æ¶æ„è®¾è®¡æ˜¯éå¸¸å¼ºçš„ï¼Œæ—©å°±è€ƒè™‘åˆ°äº†è¿™ç‚¹ï¼Œåœ¨ä¹‹å‰çš„åšå®¢[å¦‚ä½•è‡ªå®šä¹‰æ·»åŠ APIæ¥å£åœ¨Knife4jç•Œé¢ä¸­æ˜¾ç¤º](customer-add-api#-springdoc)ä¸­æˆ‘å°±åˆ†äº«äº†springdocé¡¹ç›®æä¾›çš„`customizer`æ¥å£

- ğŸœï¸ `GlobalOperationCustomizer`ï¼šé’ˆå¯¹Operationçº§åˆ«çš„å…¨å±€è‡ªå®šä¹‰æ‰©å±•é’©å­å‡½æ•°ï¼Œå¼€å‘è€…å¯ä»¥å¯¹æ¥å£ä¸­æ¯ä¸€ä¸ªOperationè¿›è¡Œæ‰©å±•è‡ªå®šä¹‰å®ç°ï¼Œæˆ–è°ƒæ•´ï¼Œæˆ–ä¿®æ”¹ï¼Œæˆ–å¢åŠ æ‰©å±•éƒ½è¡Œï¼ŒKnife4jçš„éƒ¨åˆ†å¢å¼ºç‰¹æ€§å°±æ˜¯åŸºäºæ­¤å‡½æ•°å®ç°ï¼Œå¯ä»¥å‚è€ƒä»£ç [Knife4jJakartaOperationCustomizer.java](https://gitee.com/xiaoym/knife4j/blob/dev/knife4j/knife4j-openapi3-jakarta-spring-boot-starter/src/main/java/com/github/xiaoymin/knife4j/spring/extension/Knife4jJakartaOperationCustomizer.java)
- ğŸï¸ `GlobalOpenApiCustomizer`ï¼šæ˜¯é’ˆå¯¹æ•´ä¸ªOpenAPIçº§åˆ«çš„,å¼€å‘è€…åœ¨åˆ†ç»„æˆ–è€…åˆ†åŒ…åï¼Œå¾—åˆ°çš„å•ä¸ªOpenAPIå®ä¾‹ï¼Œå¼€å‘è€…å¯ä»¥æ“çºµå…¨å±€çš„OpenAPIå®ä¾‹ï¼Œè¯¥OpenAPIå¯¹è±¡å·²ç»æ˜¯springdocè§£æè¿‡çš„å®ä¾‹å¯¹è±¡ï¼Œä¾‹å¦‚è¯¥issuesä¸­çš„éœ€æ±‚ï¼Œå¼€å‘è€…åªéœ€è¦è‡ªå®šä¹‰åˆ›å»ºæ–°Operationå¯¹è±¡ï¼Œç„¶åé€šè¿‡OpenAPIå®ä¾‹å¯¹è±¡è¿›è¡Œaddæ·»åŠ å³å¯å®Œæˆæ­¤éœ€æ±‚ï¼Œéƒ¨åˆ†æ‰©å±•å¯ä»¥å‚è€ƒä»£ç ï¼š[Knife4jOpenApiCustomizer.java](https://gitee.com/xiaoym/knife4j/blob/dev/knife4j/knife4j-openapi3-jakarta-spring-boot-starter/src/main/java/com/github/xiaoymin/knife4j/spring/extension/Knife4jOpenApiCustomizer.java)


å¼€å‘è€…å¯ä»¥å€ŸåŠ©`GlobalOpenApiCustomizer`æ¥å£ï¼Œç»™æŸä¸€ä¸ªOpenAPIå®ä¾‹åˆ†ç»„ä¸‹çš„æ‰€æœ‰æ¥å£æ·»åŠ é‰´æƒæ–¹æ¡ˆï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
@Bean
public GlobalOpenApiCustomizer orderGlobalOpenApiCustomizer() {
    return openApi -> {
        // å…¨å±€æ·»åŠ é‰´æƒå‚æ•°
        if(openApi.getPaths()!=null){
            openApi.getPaths().forEach((s, pathItem) -> {
                // ä¸ºæ‰€æœ‰æ¥å£æ·»åŠ é‰´æƒ
                pathItem.readOperations().forEach(operation -> {
                    peration.addSecurityItem(new SecurityRequirement().addList(HttpHeaders.AUTHORIZATION));
                });
            });
        }

    };
}
```

è¿™æ ·å°±å¯ä»¥å®ç°æ‰€æœ‰æ¥å£éƒ½æ·»åŠ é‰´æƒæ–¹æ¡ˆï¼Œè€Œä¸éœ€è¦åœ¨æ¯ä¸ªæ¥å£ä¸Šæ·»åŠ `@SecurityRequirement`æ³¨è§£äº†ï¼Œè€Œè¿™æ ·å¤„ç†çš„æ–¹å¼ä¹Ÿæœ‰å‡ ä¸ªå¥½å¤„ï¼š

- æ»¡è¶³å¼€å‘è€…çš„å…¨å±€é‰´æƒéœ€æ±‚
- å¼€å‘è€…å¯ä»¥é€šè¿‡ä»£ç çµæ´»çš„æ§åˆ¶æ¥å£æ˜¯å¦éœ€è¦é‰´æƒï¼Œæ¯”å¦‚æ¥å£çš„urlè·¯å¾„ã€æ–¹æ³•ç­‰
