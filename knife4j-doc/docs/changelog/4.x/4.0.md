# v4.0.0ç‰ˆæœ¬-2022/12/20

Knife4j 4.0ç‰ˆæœ¬ä»Šå¤©æ­£å¼å‘å¸ƒäº†ï¼ ğŸ‰ğŸ‰ğŸ‰

è¯¥ç‰ˆæœ¬å¤„ç†äº†è¿‘12ä¸ªæœˆä»¥æ¥Giteeã€GitHubä¸¤å¤§å¹³å°ç§¯å‹çš„è¿‘300å¤šä¸ªissue

åŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸€äº›æ–°çš„ç‰¹æ€§ã€‚

**ä¸»è¦æ›´æ–°äº®ç‚¹ï¼š**

- ğŸ†•ç»Ÿä¸€å„ä¸ªç»„ä»¶ç‰ˆæœ¬å·,ä½¿ç”¨Knife4jæ—¶å¼€å‘è€…æ ¹æ®éœ€è¦è‡ªè¡Œå¼•ç”¨,**artifactIdå‘ç”Ÿäº†å˜åŒ–**
- ğŸ’¯**æ”¯æŒ`Spring Boot 3`**
- ğŸŒ¼å…¼å®¹é€‚é…`springdoc-openapi`åº•å±‚æ¡†æ¶ï¼Œå…¨é¢è¿ç§»åˆ°`OpenAPI3`çš„è§„èŒƒæ”¯æŒ
- ğŸŒ¿é’ˆå¯¹OpenAPI2(Swagger)è§„èŒƒæä¾›äº†ä¼˜åŒ–ï¼Œå¼€å‘è€…åŸºäºSpring Boot2ç‰ˆæœ¬å¯ä»¥æ— ç¼è¡”æ¥
- ğŸ’ªKnife4j-Desktopç»„ä»¶æ¶æ„å‡çº§é‡å†™ï¼Œæ–°æ¶æ„æ”¯æŒä¸åŒéœ€æ±‚çš„OpenAPIè§„èŒƒè¿›è¡Œèšåˆ
- ğŸ’ªæä¾›å®˜æ–¹Dockeré•œåƒæœåŠ¡ï¼ŒåŸºäºKnife4jå¯æ–¹ä¾¿åœ¨äº‘æœåŠ¡ä¸Šè¿›è¡Œä½¿ç”¨
- ğŸ’¥å®˜ç½‘æ–‡æ¡£æ›´æ–°é‡å†™

## æ¶æ„æ•´ç†

ä¸ºäº†ä»¥åKnife4jå‘å±•çš„å¯æŒç»­æ€§ï¼Œæ•´ä¸ªæ¶æ„é‡æ–°æ¢³ç†ï¼Œåç»­å¯ä»¥æ ¹æ®ä¸åŒçš„éœ€æ±‚ï¼Œæä¾›ä¸åŒçš„æœåŠ¡

![](/images/website/knife4j-framework2.png)


æ–°çš„æ¶æ„å›¾ï¼Œæœ‰çš„æ˜¯è§„åˆ’(å°šæœªå®ç°)ï¼Œæœ‰çš„å·²ç»å®ç°ï¼Œæ¬¢è¿å¤§ä½¬ä¸€èµ·è´¡çŒ®ã€‚

## ç»Ÿä¸€ç‰ˆæœ¬

åœ¨æ­¤æ¬¡4.0ç‰ˆæœ¬ä¸­ï¼Œç»Ÿä¸€å„ä¸ªç‰ˆæœ¬ï¼Œå°†OpenAPI2è§„èŒƒä¸OpenAPI3è§„èŒƒåŒºåˆ†å¼€ï¼Œé¿å…ç‰ˆæœ¬åŠè§„èŒƒæ··ä¹±ä½¿ç”¨äº§ç”Ÿçš„è¯¯è§£ï¼Œä½¿ç”¨è€…å¯ä»¥æ›´æ¸…æ™°

**éœ€è¦æ³¨æ„ï¼Œ4.0ç‰ˆæœ¬`artifactId`å‘ç”Ÿäº†å˜åŒ–**

ç›®å‰`knife4j`çš„é¡¹ç›®ç»“æ„ï¼š

| æ¨¡å—åç§°                                     | è¯´æ˜                                                         |
| -------------------------------------------- | ------------------------------------------------------------ |
| knife4j-aggregation-spring-boot-starter      | åŸºäº Servlet ä½“ç³»ä¸‹çš„èšåˆä¸­é—´ä»¶                              |
| knife4j-core                                 | æ ¸å¿ƒç±»,åŒ…å«ä¸€äº›å·¥å…·åŒ…ã€å¢å¼ºæ³¨è§£ç­‰                            |
| knife4j-dependencies                         | Knife4j æä¾›çš„ dependencies å·¥ç¨‹ï¼Œå¼•å…¥è¯¥å·¥ç¨‹åï¼Œknife4j\springfox\swagger\springdoc-openapi ç­‰ç‰ˆæœ¬å·ä¸ç”¨åœ¨ç‹¬è‡ªå£°æ˜ |
| knife4j-openapi2-ui                          | å¢å¼º UI æ–‡æ¡£,è¯¥åŒ…æ˜¯ä¸€ä¸ª webjar,åªåŒ…å«å‰ç«¯ä»£ç ï¼Œæ”¯æŒ OpenAPI2 |
| knife4j-openapi3-ui                          | å¢å¼º UI æ–‡æ¡£,è¯¥åŒ…æ˜¯ä¸€ä¸ª webjar,åªåŒ…å«å‰ç«¯ä»£ç ï¼Œæ”¯æŒ OpenAPI3 |
| knife4j-gateway-spring-boot-starter          | åŸºäºSpring Cloud Gatewayç½‘å…³çš„é¡¹ç›®å¯ä»¥å¼•ç”¨è¯¥ç»„ä»¶å®ç°ç®€å•çš„æ–‡æ¡£èšåˆ,å‚è€ƒhttps://gitee.com/xiaoym/knife4j/tree/dev/knife4j/knife4j-gateway-spring-boot-starter |
| knife4j-openapi2-spring-boot-starter         | åŸºäº OpenAPI2 è§„èŒƒï¼Œåœ¨ Spring Boot < 3.0.0-M1 çš„å•ä½“æ¶æ„ä¸‹å¯ä»¥ç›´æ¥å¼•ç”¨æ­¤ starter,è¯¥æ¨¡å—åŒ…å«äº† Ui éƒ¨åˆ†ï¼Œåº•å±‚ä¾èµ– springfox-swagger 2.10.5 é¡¹ç›® |
| knife4j-openapi3-spring-boot-starter         | åŸºäº OpenAPI3 è§„èŒƒï¼Œåœ¨ Spring Boot < 3.0.0-M1 çš„å•ä½“æ¶æ„ä¸‹å¯ä»¥ç›´æ¥å¼•ç”¨æ­¤ starter,è¯¥æ¨¡å—åŒ…å«äº† Ui éƒ¨åˆ†ï¼Œåº•å±‚åŸºäº springdoc-openapi é¡¹ç›® |
| knife4j-openapi3-jakarta-spring-boot-starter | åŸºäº OpenAPI3 è§„èŒƒï¼Œåœ¨ Spring Boot >= 3.0.0-M1 çš„å•ä½“æ¶æ„ä¸‹å¯ä»¥ç›´æ¥å¼•ç”¨æ­¤ starter,è¯¥æ¨¡å—åŒ…å«äº† Ui éƒ¨åˆ†ï¼Œåº•å±‚åŸºäº springdoc-openapi é¡¹ç›® |

å¼€å‘è€…ç»§ç»­ä½¿ç”¨Spring Boot 2ä»¥åŠOpenAPI2çš„è§„èŒƒ

> è¯¥starteråº•å±‚ä¾ç„¶ä¾èµ–springfoxé¡¹ç›®ï¼Œç‰ˆæœ¬2.10.5

å¯ä»¥ä½¿ç”¨`knife4j-openapi2-spring-boot-starter`,mavenåæ ‡å¦‚ä¸‹ï¼š

```xml
<dependency>
    <groupId>com.github.xiaoymin</groupId>
    <artifactId>knife4j-openapi2-spring-boot-starter</artifactId>
    <version>4.0.0</version>
</dependency>
```

å¼€å‘è€…ä½¿ç”¨Spring Boot 2ä»¥åŠOpenAPI3è§„èŒƒï¼Œé‚£éœ€è¦è€ƒè™‘åœ¨é¡¹ç›®çš„æ³¨è§£ä¸Šåšè¿ç§»å˜æ›´ï¼Œå¹¶ä¸”knife4j 4.0ç‰ˆæœ¬é’ˆå¯¹3çš„è§„èŒƒåº•å±‚è¿ç§»ä½¿ç”¨springdoc-openapié¡¹ç›®ï¼Œæ”¾å¼ƒspringfox3.0

å¯ä»¥ä½¿ç”¨`knife4j-openapi3-spring-boot-starter`,mavenåæ ‡å¦‚ä¸‹ï¼š

```xml
<dependency>
    <groupId>com.github.xiaoymin</groupId>
    <artifactId>knife4j-openapi3-spring-boot-starter</artifactId>
    <version>4.0.0</version>
</dependency>
```

## æ”¯æŒSpring Boot 3

å¼€å‘è€…ä½¿ç”¨Spring Boot 3ä»¥åŠä½¿ç”¨OpenAPI3è§„èŒƒ

å¯ä»¥ä½¿ç”¨`knife4j-openapi3-jakarta-spring-boot-starter`,mavenåæ ‡å¦‚ä¸‹ï¼š

```xml
<dependency>
    <groupId>com.github.xiaoymin</groupId>
    <artifactId>knife4j-openapi3-jakarta-spring-boot-starter</artifactId>
    <version>4.0.0</version>
</dependency>
```

# Knife4jé…ç½®å±æ€§å˜åŒ–

æ­¤æ¬¡Knife4jæä¾›çš„Spring Boot Starterç»„ä»¶ï¼Œå¢å¼ºé…ç½®å±æ€§é€šè¿‡`spring-boot-configuration-processor`å·¥å…·è‡ªåŠ¨ç”Ÿæˆ`spring-configuration-metadata.json`æè¿°æ€§æ–‡ä»¶ï¼Œå› æ­¤ï¼Œä¸åŒäºä¹‹å‰çš„ç‰ˆæœ¬ï¼Œé…ç½®å±æ€§ä¼šå°†ä¹‹å‰çš„å‘½åå¤§å†™å…¨éƒ¨è½¬ä¸ºä¸‹åˆ’çº¿

**Knife4jä¹‹å‰çš„å¢å¼ºé…ç½®å±æ€§(`è€çš„`)ï¼š**

```yaml
knife4j:
  enable: true
# ä»¥settingé…ç½®ä¸ºä¾‹
  setting:
    language: zh-CN
    enableSwaggerModels: true
    enableDocumentManage: true
```

**Knife4j 4.0é…ç½®çš„å¢å¼ºå±æ€§(`æ–°çš„`):**

```yaml
knife4j:
  enable: true
  setting:
    custom-code: 500
    enable-footer-custom: false
    footer-custom-content: æˆ‘æ˜¯è‡ªå®šä¹‰çš„Footer
```

## springdoc-openapié¡¹ç›®å¢å¼ºé€‚é…

Knife4jä¹‹å‰çš„ç‰ˆæœ¬ä¸€ç›´éƒ½æ˜¯åŸºäºspringfoxé¡¹ç›®æä¾›äº†å¢å¼ºåŠŸèƒ½ï¼Œæ­¤æ¬¡4.0ç‰ˆæœ¬é’ˆå¯¹springdoc-openapié¡¹ç›®ä¹Ÿæä¾›äº†å¢å¼ºï¼ŒKnife4jæä¾›çš„å¢å¼ºåŠŸèƒ½å¯ä»¥æ— ç¼åœ¨OpenAPI3çš„è§„èŒƒä¸­ä½¿ç”¨

## Knife4jç‹¬ç«‹æœåŠ¡å·¥å…·æ¶æ„å‡çº§

Knife4jåœ¨æ­¤æ¬¡ç‰ˆæœ¬ä¸­é’ˆå¯¹èšåˆOpenAPIè§„èŒƒæ–‡æ¡£æä¾›äº†ç‹¬ç«‹çš„æœåŠ¡ç»„ä»¶

æ•´ä¸ªæ¶æ„é‡æ–°è®¾è®¡ï¼Œä»£ç é‡å†™ï¼Œå¹¶å°†è¯¥æœåŠ¡å‘å¸ƒåˆ°Dockerå®˜æ–¹é•œåƒä»“åº“ï¼Œæ”¯æŒä¸åŒé…ç½®ä¸­å¿ƒä¸­é—´ä»¶å¯¹æ¥ï¼Œæ•°æ®+åº”ç”¨è¿›è¡Œåˆ†ç¦»ï¼ŒOpenAPIçš„æ•°æ®æºå¯ä»¥è½»æ¾æ”¾åˆ°é…ç½®ä¸­å¿ƒä¸­ï¼Œå®ç°æ–‡æ¡£çš„èšåˆ

æ¶æ„å›¾å¦‚ä¸‹ï¼š
![](/images/website/upgrade/v4-0/knife4j-desktop-architecture.png)

è¯¦ç»†ä½¿ç”¨è¯´æ˜è¯·[å‚è€ƒæ–‡æ¡£](/docs/middleware-sources/desktop-introduction)


## æ–‡æ¡£

Knife4jæ–°ç‰ˆæœ¬æ–‡æ¡£é‡‡ç”¨æ–°çš„æ¨¡æ¿ï¼Œå¯ä»¥åŒºåˆ†ä¸åŒçš„ç‰ˆæœ¬ï¼Œæ–¹ä¾¿å¼€å‘ä½¿ç”¨è€…PRè´¡çŒ®æˆ–è€…æŸ¥çœ‹



> â—4.0ç‰ˆæœ¬çš„æ–‡æ¡£ä½œè€…æ­£åœ¨ç–¯ç‹‚ç å­—ä¸­â€¦â€¦.æ•¬è¯·æœŸå¾….

## ç¤ºä¾‹ç¨‹åº

æ­£æ˜¯ç”±äº4.0çš„æ–‡æ¡£è¿˜åœ¨è¾“å‡ºä¸­ï¼Œå› æ­¤Knife4jåœ¨4.0æ–°ç‰ˆæœ¬ä¸­ä¹Ÿæä¾›äº†ä¸åŒç‰ˆæœ¬çš„ç¤ºä¾‹ç¨‹åº

ç¤ºä¾‹å¦‚ä¸‹ï¼š

- Spring Boot 2.x + OpenAPI2è§„èŒƒï¼š[knife4j-spring-boot27-demo](https://gitee.com/xiaoym/swagger-bootstrap-ui-demo/tree/master/knife4j-spring-boot27-demo)
- Spring Boot 2.x +OpenAPI3è§„èŒƒï¼š[knife4j-springdoc-openapi-demo](https://gitee.com/xiaoym/swagger-bootstrap-ui-demo/tree/master/knife4j-springdoc-openapi-demo)
- Spring Boot 3+ OpenAPI3è§„èŒƒï¼š[knife4j-spring-boot3-demo](https://gitee.com/xiaoym/swagger-bootstrap-ui-demo/tree/master/knife4j-spring-boot3-demo)

## ç¤¾åŒº

**æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥åŠ ç¾¤å‚ä¸è®¨è®ºè´¡çŒ®**

å…³æ³¨å®˜ç½‘åº•éƒ¨å…¬ä¼—å·"Knife4j"ï¼Œç‚¹å‡»èœå•è·å–åŠ ç¾¤äºŒç»´ç 


æ•´ä¸ª4.0ç‰ˆæœ¬ä»ç¡®å®šå¼€å‘æ–¹å‘ä»¥åŠè¿­ä»£è¿‡ç¨‹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥é€šè¿‡è¯¥issueäº†è§£ï¼š

[https://gitee.com/xiaoym/knife4j/issues/I5LIQZ](https://gitee.com/xiaoym/knife4j/issues/I5LIQZ)